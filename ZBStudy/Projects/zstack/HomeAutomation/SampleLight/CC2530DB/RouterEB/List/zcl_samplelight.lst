###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Nov/2016  11:44:02 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\Source\zcl_samplelight.c       #
#    Command line       =  -f E:\gitshell\ZigBee\ZBStudy\Projects\zstack\Home #
#                          Automation\SampleLight\CC2530DB\..\..\..\Tools\CC2 #
#                          530DB\f8wRouter.cfg (-DCPU32MHZ                    #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0           #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF2                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wZCL.cfg (-DZCL_READ -DZCL_WRITE -DZCL_BASIC  #
#                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH    #
#                          -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4     #
#                          -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10    #
#                          -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10   #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING -DZCL_MESSAGE -DZCL_TUNNELING        #
#                          -DZCL_TOU) -DZCL_DEVICE_MGMT                       #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\Source\zcl_samplelight.c -D    #
#                          ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC  #
#                          -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC          #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\RouterEB\List\ -lA    #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\RouterEB\List\        #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\RouterEB\Obj\ -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I E:\gitshell\ZigBee\ZBStudy\Projects\zstack\Home #
#                          Automation\SampleLight\CC2530DB\ -I                #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\Source\ -I         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\Source\ -I      #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\ZMain\TI2530 #
#                          DB\ -I E:\gitshell\ZigBee\ZBStudy\Projects\zstack\ #
#                          HomeAutomation\SampleLight\CC2530DB\..\..\..\..\.. #
#                          \Components\hal\include\ -I                        #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\hal\target\CC2530EB\ -I                       #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\include\ -I E:\gitshell\ZigBee\ZBStudy\Pr #
#                          ojects\zstack\HomeAutomation\SampleLight\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\high_level\ -I       #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\low_level\srf04\ -I                       #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\low_level\srf04\single_chip\ -I           #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mt\ -I E:\gitshell\ZigBee\ZBStudy\Projects\zs #
#                          tack\HomeAutomation\SampleLight\CC2530DB\..\..\..\ #
#                          ..\..\Components\osal\include\ -I                  #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\services\saddr\ -I E:\gitshell\ZigBee\ZBStudy #
#                          \Projects\zstack\HomeAutomation\SampleLight\CC2530 #
#                          DB\..\..\..\..\..\Components\services\sdata\ -I    #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\af\ -I E:\gitshell\ZigBee\ZBStudy\Proje #
#                          cts\zstack\HomeAutomation\SampleLight\CC2530DB\..\ #
#                          ..\..\..\..\Components\stack\nwk\ -I               #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\sapi\ -I E:\gitshell\ZigBee\ZBStudy\Pro #
#                          jects\zstack\HomeAutomation\SampleLight\CC2530DB\. #
#                          .\..\..\..\..\Components\stack\sec\ -I             #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\sys\ -I E:\gitshell\ZigBee\ZBStudy\Proj #
#                          ects\zstack\HomeAutomation\SampleLight\CC2530DB\.. #
#                          \..\..\..\..\Components\stack\zcl\ -I              #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\zdo\ -I E:\gitshell\ZigBee\ZBStudy\Proj #
#                          ects\zstack\HomeAutomation\SampleLight\CC2530DB\.. #
#                          \..\..\..\..\Components\zmac\ -I                   #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\..\..\..\..\..\Compon #
#                          ents\zmac\f8w\ -Ohz --require_prototypes           #
#    List file          =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\RouterEB\List\zcl_sam #
#                          plelight.lst                                       #
#    Object file        =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleLight\CC2530DB\RouterEB\Obj\zcl_samp #
#                          lelight.r51                                        #
#                                                                             #
#                                                                             #
###############################################################################

E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAutomation\SampleLight\Source\zcl_samplelight.c
      1          /**************************************************************************************************
      2            Filename:       zcl_sampleLight.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6          
      7            Description:    Zigbee Cluster Library - sample device application.
      8          
      9          
     10            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42            This device will be like a Light device.  This application is not
     43            intended to be a Light device, but will use the device description
     44            to implement this sample code.
     45          *********************************************************************/
     46          
     47          /*********************************************************************
     48           * INCLUDES
     49           */
     50          #include "ZComDef.h"
     51          #include "OSAL.h"
     52          #include "AF.h"
     53          #include "ZDApp.h"
     54          #include "ZDObject.h"
     55          
     56          #include "zcl.h"
     57          #include "zcl_general.h"
     58          #include "zcl_ha.h"
     59          
     60          #include "zcl_samplelight.h"
     61          
     62          #include "onboard.h"
     63          
     64          /* HAL */
     65          #include "hal_lcd.h"
     66          #include "hal_led.h"
     67          #include "hal_key.h"
     68          
     69          
     70          /*********************************************************************
     71           * MACROS
     72           */
     73          
     74          /*********************************************************************
     75           * CONSTANTS
     76           */
     77          /*********************************************************************
     78           * TYPEDEFS
     79           */
     80          
     81          /*********************************************************************
     82           * GLOBAL VARIABLES
     83           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     84          byte zclSampleLight_TaskID;
   \                     zclSampleLight_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     85          
     86          /*********************************************************************
     87           * GLOBAL FUNCTIONS
     88           */
     89          
     90          /*********************************************************************
     91           * LOCAL VARIABLES
     92           */
     93          // Test Endpoint to allow SYS_APP_MSGs

   \                                 In  segment XDATA_I, align 1, keep-with-next
     94          static endPointDesc_t sampleLight_TestEp =
   \                     sampleLight_TestEp:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for sampleLight_TestEp>`
   \   000006                REQUIRE __INIT_XDATA_I
     95          {
     96            SAMPLELIGHT_ENDPOINT,                                 // Test endpoint
     97            &zclSampleLight_TaskID,
     98            (SimpleDescriptionFormat_t *)&zclSampleLight_SimpleDesc,  // No Simple description for this test endpoint
     99            (afNetworkLatencyReq_t)0            // No Network Latency req
    100          };
    101          
    102          /*********************************************************************
    103           * LOCAL FUNCTIONS
    104           */
    105          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    106          static void zclSampleLight_HandleKeys( byte shift, byte keys );
    107          static void zclSampleLight_BasicResetCB( void );
    108          static void zclSampleLight_IdentifyCB( zclIdentify_t *pCmd );
    109          static void zclSampleLight_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp );
    110          static void zclSampleLight_OnOffCB( uint8 cmd );
    111          static void zclSampleLight_ProcessIdentifyTimeChange( void );
    112          
    113          // Functions to process ZCL Foundation incoming Command/Response messages 
    114          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    115          #ifdef ZCL_READ
    116          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    117          #endif
    118          #ifdef ZCL_WRITE
    119          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    120          #endif
    121          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    122          #ifdef ZCL_DISCOVER
    123          static uint8 zclSampleLight_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg );
    124          #endif
    125          
    126          /*********************************************************************
    127           * ZCL General Profile Callback table
    128           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          static zclGeneral_AppCallbacks_t zclSampleLight_CmdCallbacks =
   \                     zclSampleLight_CmdCallbacks:
   \   000000                DS 30
   \   00001E                REQUIRE `?<Initializer for zclSampleLight_CmdCallbacks>`
   \   00001E                REQUIRE __INIT_XDATA_I
    130          {
    131            zclSampleLight_BasicResetCB,              // Basic Cluster Reset command
    132            zclSampleLight_IdentifyCB,                // Identify command  
    133            zclSampleLight_IdentifyQueryRspCB,        // Identify Query Response command
    134            zclSampleLight_OnOffCB,                   // On/Off cluster command
    135            NULL,                                     // Level Control Move to Level command
    136            NULL,                                     // Level Control Move command
    137            NULL,                                     // Level Control Step command
    138            NULL,                                     // Group Response commands
    139            NULL,                                     // Scene Store Request command
    140            NULL,                                     // Scene Recall Request command
    141            NULL,                                     // Scene Response command
    142            NULL,                                     // Alarm (Response) command
    143            NULL,                                     // RSSI Location commands
    144            NULL,                                     // RSSI Location Response commands
    145          };
    146          
    147          /*********************************************************************
    148           * @fn          zclSampleLight_Init
    149           *
    150           * @brief       Initialization function for the zclGeneral layer.
    151           *
    152           * @param       none
    153           *
    154           * @return      none
    155           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    156          void zclSampleLight_Init( byte task_id )
   \                     zclSampleLight_Init:
    157          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    158            zclSampleLight_TaskID = task_id;
   \   000007   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   00000A   F0           MOVX    @DPTR,A
    159          
    160            // This app is part of the Home Automation Profile
    161            zclHA_Init( &zclSampleLight_SimpleDesc );
   \   00000B                ; Setup parameters for call to function zclHA_Init
   \   00000B   7A..         MOV     R2,#zclSampleLight_SimpleDesc & 0xff
   \   00000D   7B..         MOV     R3,#(zclSampleLight_SimpleDesc >> 8) & 0xff
   \   00000F   12....       LCALL   ??zclHA_Init?relay
    162          
    163            // Register the ZCL General Cluster Library callback functions
    164            zclGeneral_RegisterCmdCallbacks( SAMPLELIGHT_ENDPOINT, &zclSampleLight_CmdCallbacks );
   \   000012                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   000012   7A..         MOV     R2,#zclSampleLight_CmdCallbacks & 0xff
   \   000014   7B..         MOV     R3,#(zclSampleLight_CmdCallbacks >> 8) & 0xff
   \   000016   790D         MOV     R1,#0xd
   \   000018   12....       LCALL   ??zclGeneral_RegisterCmdCallbacks?relay
    165          
    166            // Register the application's attribute list
    167            zcl_registerAttrList( SAMPLELIGHT_ENDPOINT, SAMPLELIGHT_MAX_ATTRIBUTES, zclSampleLight_Attrs );
   \   00001B                ; Setup parameters for call to function zcl_registerAttrList
   \   00001B   7C..         MOV     R4,#zclSampleLight_Attrs & 0xff
   \   00001D   7D..         MOV     R5,#(zclSampleLight_Attrs >> 8) & 0xff
   \   00001F   7A0C         MOV     R2,#0xc
   \   000021   790D         MOV     R1,#0xd
   \   000023   12....       LCALL   ??zcl_registerAttrList?relay
    168          
    169            // Register the Application to receive the unprocessed Foundation command/response messages
    170            zcl_registerForMsg( zclSampleLight_TaskID );
   \   000026                ; Setup parameters for call to function zcl_registerForMsg
   \   000026   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   12....       LCALL   ??zcl_registerForMsg?relay
    171            
    172            // Register for all key events - This app will handle all key events
    173            RegisterForKeys( zclSampleLight_TaskID );
   \   00002E                ; Setup parameters for call to function RegisterForKeys
   \   00002E   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F9           MOV     R1,A
   \   000033   12....       LCALL   ??RegisterForKeys?relay
    174          
    175            // Register for a test endpoint
    176            afRegister( &sampleLight_TestEp );
   \   000036                ; Setup parameters for call to function afRegister
   \   000036   7A..         MOV     R2,#sampleLight_TestEp & 0xff
   \   000038   7B..         MOV     R3,#(sampleLight_TestEp >> 8) & 0xff
   \   00003A   12....       LCALL   ??afRegister?relay
    177            
    178            ZDO_RegisterForZDOMsg( task_id,  End_Device_Bind_rsp );
   \   00003D                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00003D   7A20         MOV     R2,#0x20
   \   00003F   7B80         MOV     R3,#-0x80
   \   000041   EE           MOV     A,R6
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    179          }
   \   000046                REQUIRE ?Subroutine0
   \   000046                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    180          
    181          /*********************************************************************
    182           * @fn          zclSample_event_loop
    183           *
    184           * @brief       Event Loop Processor for zclGeneral.
    185           *
    186           * @param       none
    187           *
    188           * @return      none
    189           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    190          uint16 zclSampleLight_event_loop( uint8 task_id, uint16 events )
   \                     zclSampleLight_event_loop:
    191          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    192            afIncomingMSGPacket_t *MSGpkt;
    193            
    194            (void)task_id;  // Intentionally unreferenced parameter
    195          
    196            if ( events & SYS_EVENT_MSG )
   \   00000E   EB           MOV     A,R3
   \   00000F   5480         ANL     A,#0x80
   \   000011   6003         JZ      $+5
   \   000013   02....       LJMP    ??zclSampleLight_event_loop_0 & 0xFFFF
    197            {
    198              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclSampleLight_TaskID )) )
    199              {
    200                switch ( MSGpkt->hdr.event )
    201                {
    202                 case ZDO_CB_MSG:
    203                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    204                    break;
    205                    
    206                 case ZCL_INCOMING_MSG:
    207                    // Incoming ZCL Foundation command/response messages
    208                    zclSampleLight_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    209                    break;
    210                    
    211                  case KEY_CHANGE:
    212                    zclSampleLight_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    213                    break;
    214          
    215                  default:
    216                    break;
    217                }
    218          
    219                // Release the memory
    220                osal_msg_deallocate( (uint8 *)MSGpkt );
    221              }
    222          
    223              // return unprocessed events
    224              return (events ^ SYS_EVENT_MSG);
    225            }
    226          
    227            // Discard unknown events
    228            return 0;
   \   000016   7A00         MOV     R2,#0x0
   \   000018   7B00         MOV     R3,#0x0
   \                     ??zclSampleLight_event_loop_1:
   \   00001A   7409         MOV     A,#0x9
   \   00001C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001F   7F04         MOV     R7,#0x4
   \   000021   02....       LJMP    ?BANKED_LEAVE_XDATA
   \                     ??zclSampleLight_event_loop_2:
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   A2E1         MOV     C,0xE0 /* A   */.1
   \   00002A   5063         JNC     ??zclSampleLight_event_loop_3
   \   00002C   7408         MOV     A,#0x8
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   7402         MOV     A,#0x2
   \   000033   F0           MOVX    @DPTR,A
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   E4           CLR     A
   \   00003B   F0           MOVX    @DPTR,A
   \   00003C   A3           INC     DPTR
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00003E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000041   8A..         MOV     ?V0 + 2,R2
   \   000043   8B..         MOV     ?V0 + 3,R3
   \   000045   AC..         MOV     R4,?V0 + 2
   \   000047   AD..         MOV     R5,?V0 + 3
   \   000049                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000049   75..01       MOV     ?V0 + 2,#0x1
   \   00004C   78..         MOV     R0,#?V0 + 2
   \   00004E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000051   E4           CLR     A
   \   000052   F5..         MOV     ?V0 + 2,A
   \   000054   F5..         MOV     ?V0 + 3,A
   \   000056   78..         MOV     R0,#?V0 + 2
   \   000058   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005B   78..         MOV     R0,#?V0 + 2
   \   00005D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000060   90....       MOV     DPTR,#zclSampleLight_SimpleDesc + 7
   \   000063   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000066   90....       MOV     DPTR,#zclSampleLight_SimpleDesc + 6
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F5..         MOV     ?V0 + 2,A
   \   00006C   78..         MOV     R0,#?V0 + 2
   \   00006E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000071   75..04       MOV     ?V0 + 2,#0x4
   \   000074   75..01       MOV     ?V0 + 3,#0x1
   \   000077   78..         MOV     R0,#?V0 + 2
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007C   790D         MOV     R1,#0xd
   \   00007E   7409         MOV     A,#0x9
   \   000080   12....       LCALL   ?XSTACK_DISP0_8
   \   000083   AA82         MOV     R2,DPL
   \   000085   AB83         MOV     R3,DPH
   \   000087   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00008A   7409         MOV     A,#0x9
   \   00008C   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??zclSampleLight_event_loop_3:
   \   00008F                ; Setup parameters for call to function osal_msg_deallocate
   \   00008F   EE           MOV     A,R6
   \   000090   FA           MOV     R2,A
   \   000091   EF           MOV     A,R7
   \   000092   FB           MOV     R3,A
   \   000093   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??zclSampleLight_event_loop_0:
   \   000096                ; Setup parameters for call to function osal_msg_receive
   \   000096   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   F9           MOV     R1,A
   \   00009B   12....       LCALL   ??osal_msg_receive?relay
   \   00009E   8A..         MOV     ?V0 + 2,R2
   \   0000A0   8B..         MOV     ?V0 + 3,R3
   \   0000A2   AE..         MOV     R6,?V0 + 2
   \   0000A4   AF..         MOV     R7,?V0 + 3
   \   0000A6   EE           MOV     A,R6
   \   0000A7   4F           ORL     A,R7
   \   0000A8   7003         JNZ     $+5
   \   0000AA   02....       LJMP    ??zclSampleLight_event_loop_4 & 0xFFFF
   \   0000AD   8E82         MOV     DPL,R6
   \   0000AF   8F83         MOV     DPH,R7
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   24CC         ADD     A,#-0x34
   \   0000B4   603E         JZ      ??zclSampleLight_event_loop_5
   \   0000B6   2474         ADD     A,#0x74
   \   0000B8   7003         JNZ     $+5
   \   0000BA   02....       LJMP    ??zclSampleLight_event_loop_2 & 0xFFFF
   \   0000BD   24ED         ADD     A,#-0x13
   \   0000BF   70CE         JNZ     ??zclSampleLight_event_loop_3
   \   0000C1   EE           MOV     A,R6
   \   0000C2   240C         ADD     A,#0xc
   \   0000C4   F582         MOV     DPL,A
   \   0000C6   EF           MOV     A,R7
   \   0000C7   3400         ADDC    A,#0x0
   \   0000C9   F583         MOV     DPH,A
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   6420         XRL     A,#0x20
   \   0000CE   7004         JNZ     ??zclSampleLight_event_loop_6
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   6480         XRL     A,#0x80
   \                     ??zclSampleLight_event_loop_6:
   \   0000D4   70B9         JNZ     ??zclSampleLight_event_loop_3
   \   0000D6   EE           MOV     A,R6
   \   0000D7   2413         ADD     A,#0x13
   \   0000D9   F582         MOV     DPL,A
   \   0000DB   EF           MOV     A,R7
   \   0000DC   3400         ADDC    A,#0x0
   \   0000DE   F583         MOV     DPH,A
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F8           MOV     R0,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   F583         MOV     DPH,A
   \   0000E6   8882         MOV     DPL,R0
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   70A4         JNZ     ??zclSampleLight_event_loop_3
   \   0000EB                ; Setup parameters for call to function HalLedSet
   \   0000EB   7A08         MOV     R2,#0x8
   \   0000ED   7902         MOV     R1,#0x2
   \   0000EF   12....       LCALL   ??HalLedSet?relay
   \   0000F2   809B         SJMP    ??zclSampleLight_event_loop_3
   \                     ??zclSampleLight_event_loop_5:
   \   0000F4   A3           INC     DPTR
   \   0000F5   A3           INC     DPTR
   \   0000F6   A3           INC     DPTR
   \   0000F7   A3           INC     DPTR
   \   0000F8   A3           INC     DPTR
   \   0000F9   A3           INC     DPTR
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   14           DEC     A
   \   0000FD   6011         JZ      ??zclSampleLight_event_loop_7
   \   0000FF   24FD         ADD     A,#-0x3
   \   000101   701A         JNZ     ??zclSampleLight_event_loop_8
   \   000103   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000106   E0           MOVX    A,@DPTR
   \   000107   F8           MOV     R0,A
   \   000108   E9           MOV     A,R1
   \   000109   C3           CLR     C
   \   00010A   98           SUBB    A,R0
   \   00010B   5010         JNC     ??zclSampleLight_event_loop_8
   \   00010D   09           INC     R1
   \   00010E   80F6         SJMP    ??CrossCallReturnLabel_0
   \                     ??zclSampleLight_event_loop_7:
   \   000110   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000113   8001         SJMP    ??zclSampleLight_event_loop_9
   \                     ??zclSampleLight_event_loop_10:
   \   000115   09           INC     R1
   \                     ??zclSampleLight_event_loop_9:
   \   000116   E0           MOVX    A,@DPTR
   \   000117   F8           MOV     R0,A
   \   000118   E9           MOV     A,R1
   \   000119   C3           CLR     C
   \   00011A   98           SUBB    A,R0
   \   00011B   40F8         JC      ??zclSampleLight_event_loop_10
   \                     ??zclSampleLight_event_loop_8:
   \   00011D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000120   F8           MOV     R0,A
   \   000121   A3           INC     DPTR
   \   000122   E0           MOVX    A,@DPTR
   \   000123   F9           MOV     R1,A
   \   000124   E8           MOV     A,R0
   \   000125   49           ORL     A,R1
   \   000126   7003         JNZ     $+5
   \   000128   02....       LJMP    ??zclSampleLight_event_loop_3 & 0xFFFF
   \   00012B                ; Setup parameters for call to function osal_mem_free
   \   00012B   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00012E   FA           MOV     R2,A
   \   00012F   A3           INC     DPTR
   \   000130   E0           MOVX    A,@DPTR
   \   000131   FB           MOV     R3,A
   \   000132   12....       LCALL   ??osal_mem_free?relay
   \   000135   02....       LJMP    ??zclSampleLight_event_loop_3 & 0xFFFF
   \                     ??zclSampleLight_event_loop_4:
   \   000138   AA..         MOV     R2,?V0 + 0
   \   00013A   E5..         MOV     A,?V0 + 1
   \   00013C   6480         XRL     A,#0x80
   \   00013E   FB           MOV     R3,A
   \   00013F   02....       LJMP    ??zclSampleLight_event_loop_1 & 0xFFFF
    229          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   EE           MOV     A,R6
   \   000001   2417         ADD     A,#0x17
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000003   F8           MOV     R0,A
   \   000004   A3           INC     DPTR
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   8882         MOV     DPL,R0
   \   000009   8983         MOV     DPH,R1
   \   00000B   7900         MOV     R1,#0x0
   \   00000D   22           RET
    230          
    231          
    232          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    233          {
    234            switch ( inMsg->clusterID )
    235            {
    236              case End_Device_Bind_rsp:
    237                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    238                {
    239                   HalLedSet ( HAL_LED_2, HAL_LED_MODE_TOGGLE );
    240                }
    241                break;
    242                
    243             default:
    244              break;
    245            }
    246          }
    247          /*********************************************************************
    248           * @fn      zclSampleLight_HandleKeys
    249           *
    250           * @brief   Handles all key events for this device.
    251           *
    252           * @param   shift - true if in shift/alt.
    253           * @param   keys - bit field for key events. Valid entries:
    254           *                 HAL_KEY_SW_4
    255           *                 HAL_KEY_SW_3
    256           *                 HAL_KEY_SW_2
    257           *                 HAL_KEY_SW_1
    258           *
    259           * @return  none
    260           */
    261          static void zclSampleLight_HandleKeys( byte shift, byte keys )
    262          {
    263            zAddrType_t dstAddr;
    264            
    265            (void)shift;  // Intentionally unreferenced parameter
    266          
    267            if ( keys & HAL_KEY_SW_2 )
    268            {
    269              // Initiate an End Device Bind Request, this bind request will
    270              // only use a cluster list that is important to binding.
    271              dstAddr.addrMode = afAddr16Bit;
    272              dstAddr.addr.shortAddr = 0;   // Coordinator makes the match
    273              ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    274                                     SAMPLELIGHT_ENDPOINT,
    275                                     ZCL_HA_PROFILE_ID,
    276                                     zclSampleLight_SimpleDesc.AppNumInClusters, 
    277                                     zclSampleLight_SimpleDesc.pAppInClusterList,
    278                                     0, NULL,   // No Outgoing clusters to bind
    279                                     TRUE );
    280            }
    281          }
    282          
    283          /*********************************************************************
    284           * @fn      zclSampleLight_ProcessIdentifyTimeChange
    285           *
    286           * @brief   Called to process any change to the IdentifyTime attribute.
    287           *
    288           * @param   none
    289           *
    290           * @return  none
    291           */
    292          static void zclSampleLight_ProcessIdentifyTimeChange( void )
    293          {
    294            if ( zclSampleLight_IdentifyTime > 0 )
    295            {
    296             // osal_start_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT, 1000 );
    297              HalLedBlink ( HAL_LED_4, 0xFF, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME );
    298            }
    299            else
    300            {
    301              if ( zclSampleLight_OnOff )
    302                HalLedSet ( HAL_LED_4, HAL_LED_MODE_ON );
    303              else
    304                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    305             // osal_stop_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT );
    306            }
    307          }
    308          
    309          /*********************************************************************
    310           * @fn      zclSampleLight_BasicResetCB
    311           *
    312           * @brief   Callback from the ZCL General Cluster Library
    313           *          to set all the Basic Cluster attributes to default values.
    314           *
    315           * @param   none
    316           *
    317           * @return  none
    318           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    319          static void zclSampleLight_BasicResetCB( void )
   \                     zclSampleLight_BasicResetCB:
    320          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    321            // Reset all attributes to default values
    322          }
   \   000000   02....       LJMP    ?BRET
    323          
    324          /*********************************************************************
    325           * @fn      zclSampleLight_IdentifyCB
    326           *
    327           * @brief   Callback from the ZCL General Cluster Library when
    328           *          it received an Identity Command for this application.
    329           *
    330           * @param   srcAddr - source address and endpoint of the response message
    331           * @param   identifyTime - the number of seconds to identify yourself
    332           *
    333           * @return  none
    334           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    335          static void zclSampleLight_IdentifyCB( zclIdentify_t *pCmd )
   \                     zclSampleLight_IdentifyCB:
    336          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    337            zclSampleLight_IdentifyTime = pCmd->identifyTime;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F8           MOV     R0,A
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   90....       MOV     DPTR,#zclSampleLight_IdentifyTime
   \   000012   E8           MOV     A,R0
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
    338            zclSampleLight_ProcessIdentifyTimeChange();
   \   000017   E8           MOV     A,R0
   \   000018   49           ORL     A,R1
   \   000019   600F         JZ      ??zclSampleLight_IdentifyCB_0
   \   00001B                ; Setup parameters for call to function HalLedBlink
   \   00001B   7CE8         MOV     R4,#-0x18
   \   00001D   7D03         MOV     R5,#0x3
   \   00001F   7B05         MOV     R3,#0x5
   \   000021   7AFF         MOV     R2,#-0x1
   \   000023   7908         MOV     R1,#0x8
   \   000025   12....       LCALL   ??HalLedBlink?relay
   \   000028   8011         SJMP    ??zclSampleLight_IdentifyCB_1
   \                     ??zclSampleLight_IdentifyCB_0:
   \   00002A   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6004         JZ      ??zclSampleLight_IdentifyCB_2
   \   000030                ; Setup parameters for call to function HalLedSet
   \   000030   7A01         MOV     R2,#0x1
   \   000032   8002         SJMP    ??zclSampleLight_IdentifyCB_3
   \                     ??zclSampleLight_IdentifyCB_2:
   \   000034                ; Setup parameters for call to function HalLedSet
   \   000034   7A00         MOV     R2,#0x0
   \                     ??zclSampleLight_IdentifyCB_3:
   \   000036   7908         MOV     R1,#0x8
   \   000038   12....       LCALL   ??HalLedSet?relay
    339          }
   \                     ??zclSampleLight_IdentifyCB_1:
   \   00003B   D083         POP     DPH
   \   00003D   D082         POP     DPL
   \   00003F   02....       LJMP    ?BRET
    340          
    341          /*********************************************************************
    342           * @fn      zclSampleLight_IdentifyQueryRspCB
    343           *
    344           * @brief   Callback from the ZCL General Cluster Library when
    345           *          it received an Identity Query Response Command for this application.
    346           *
    347           * @param   srcAddr - requestor's address
    348           * @param   timeout - number of seconds to identify yourself (valid for query response)
    349           *
    350           * @return  none
    351           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    352          static void zclSampleLight_IdentifyQueryRspCB(  zclIdentifyQueryRsp_t *pRsp )
   \                     zclSampleLight_IdentifyQueryRspCB:
    353          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    354            // Query Response (with timeout value)
    355            (void)pRsp;
    356          }
   \   000000   02....       LJMP    ?BRET
    357          
    358          /*********************************************************************
    359           * @fn      zclSampleLight_OnOffCB
    360           *
    361           * @brief   Callback from the ZCL General Cluster Library when
    362           *          it received an On/Off Command for this application.
    363           *
    364           * @param   cmd - COMMAND_ON, COMMAND_OFF or COMMAND_TOGGLE
    365           *
    366           * @return  none
    367           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    368          static void zclSampleLight_OnOffCB( uint8 cmd )
   \                     zclSampleLight_OnOffCB:
    369          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    370            // Turn on the light
    371            if ( cmd == COMMAND_ON )
   \   000007   7401         MOV     A,#0x1
   \   000009   6E           XRL     A,R6
   \   00000A   700E         JNZ     ??zclSampleLight_OnOffCB_0
    372              zclSampleLight_OnOff = LIGHT_ON;
   \                     ??zclSampleLight_OnOffCB_1:
   \   00000C   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   00000F   7401         MOV     A,#0x1
   \   000011   F0           MOVX    @DPTR,A
    373          
    374            // Turn off the light
    375            else if ( cmd == COMMAND_OFF )
    376              zclSampleLight_OnOff = LIGHT_OFF;
    377          
    378            // Toggle the light
    379            else
    380            {
    381              if ( zclSampleLight_OnOff == LIGHT_OFF )
    382                zclSampleLight_OnOff = LIGHT_ON;
    383              else
    384                zclSampleLight_OnOff = LIGHT_OFF;
    385            }
    386          
    387            // In this sample app, we use LED4 to simulate the Light
    388            if ( zclSampleLight_OnOff == LIGHT_ON )
    389              HalLedSet( HAL_LED_1, HAL_LED_MODE_ON );//ÊÕµ½onoffÃüÁîºóLED1Ö¸Ê¾
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   FA           MOV     R2,A
   \   000013   F9           MOV     R1,A
   \                     ??zclSampleLight_OnOffCB_2:
   \   000014   12....       LCALL   ??HalLedSet?relay
    390            else
    391              HalLedSet( HAL_LED_1, HAL_LED_MODE_OFF );
    392          }
   \   000017   02....       LJMP    ?Subroutine0 & 0xFFFF
   \                     ??zclSampleLight_OnOffCB_0:
   \   00001A   EE           MOV     A,R6
   \   00001B   700A         JNZ     ??zclSampleLight_OnOffCB_3
   \                     ??zclSampleLight_OnOffCB_4:
   \   00001D   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   000020   E4           CLR     A
   \   000021   F0           MOVX    @DPTR,A
   \   000022                ; Setup parameters for call to function HalLedSet
   \   000022   FA           MOV     R2,A
   \   000023   7901         MOV     R1,#0x1
   \   000025   80ED         SJMP    ??zclSampleLight_OnOffCB_2
   \                     ??zclSampleLight_OnOffCB_3:
   \   000027   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   70F0         JNZ     ??zclSampleLight_OnOffCB_4
   \   00002D   80DD         SJMP    ??zclSampleLight_OnOffCB_1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sampleLight_TestEp>`:
   \   000000   0D           DB 13
   \   000001   ....         DW zclSampleLight_TaskID
   \   000003   ....         DW zclSampleLight_SimpleDesc
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleLight_CmdCallbacks>`:
   \   000000   ....         DW ??zclSampleLight_BasicResetCB?relay
   \   000002   ....         DW ??zclSampleLight_IdentifyCB?relay
   \   000004   ....         DW ??zclSampleLight_IdentifyQueryRspCB?relay
   \   000006   ....         DW ??zclSampleLight_OnOffCB?relay
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H
   \   000012   0000         DW 0H
   \   000014   0000         DW 0H
   \   000016   0000         DW 0H
   \   000018   0000         DW 0H
   \   00001A   0000         DW 0H
   \   00001C   0000         DB 0, 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_BasicResetCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_IdentifyCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_IdentifyCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_IdentifyQueryRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_IdentifyQueryRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_OnOffCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_OnOffCB
    393          
    394          
    395          /****************************************************************************** 
    396           * 
    397           *  Functions for processing ZCL Foundation incoming Command/Response messages
    398           *
    399           *****************************************************************************/
    400          
    401          /*********************************************************************
    402           * @fn      zclSampleLight_ProcessIncomingMsg
    403           *
    404           * @brief   Process ZCL Foundation incoming message
    405           *
    406           * @param   pInMsg - pointer to the received message
    407           *
    408           * @return  none
    409           */
    410          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg)
    411          {
    412            switch ( pInMsg->zclHdr.commandID )
    413            {
    414          #ifdef ZCL_READ
    415              case ZCL_CMD_READ_RSP:
    416                zclSampleLight_ProcessInReadRspCmd( pInMsg );
    417                break;
    418          #endif
    419          #ifdef ZCL_WRITE    
    420              case ZCL_CMD_WRITE_RSP:
    421                zclSampleLight_ProcessInWriteRspCmd( pInMsg );
    422                break;
    423          #endif
    424          #ifdef ZCL_REPORT
    425              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    426              case ZCL_CMD_CONFIG_REPORT:
    427                //zclSampleLight_ProcessInConfigReportCmd( pInMsg );
    428                break;
    429              
    430              case ZCL_CMD_CONFIG_REPORT_RSP:
    431                //zclSampleLight_ProcessInConfigReportRspCmd( pInMsg );
    432                break;
    433              
    434              case ZCL_CMD_READ_REPORT_CFG:
    435                //zclSampleLight_ProcessInReadReportCfgCmd( pInMsg );
    436                break;
    437              
    438              case ZCL_CMD_READ_REPORT_CFG_RSP:
    439                //zclSampleLight_ProcessInReadReportCfgRspCmd( pInMsg );
    440                break;
    441              
    442              case ZCL_CMD_REPORT:
    443                //zclSampleLight_ProcessInReportCmd( pInMsg );
    444                break;
    445          #endif   
    446              case ZCL_CMD_DEFAULT_RSP:
    447                zclSampleLight_ProcessInDefaultRspCmd( pInMsg );
    448                break;
    449          #ifdef ZCL_DISCOVER     
    450              case ZCL_CMD_DISCOVER_RSP:
    451                zclSampleLight_ProcessInDiscRspCmd( pInMsg );
    452                break;
    453          #endif  
    454              default:
    455                break;
    456            }
    457            
    458            if ( pInMsg->attrCmd )
    459              osal_mem_free( pInMsg->attrCmd );
    460          }
    461          
    462          #ifdef ZCL_READ
    463          /*********************************************************************
    464           * @fn      zclSampleLight_ProcessInReadRspCmd
    465           *
    466           * @brief   Process the "Profile" Read Response Command
    467           *
    468           * @param   pInMsg - incoming message to process
    469           *
    470           * @return  none
    471           */
    472          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    473          {
    474            zclReadRspCmd_t *readRspCmd;
    475            uint8 i;
    476          
    477            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    478            for (i = 0; i < readRspCmd->numAttr; i++)
    479            {
    480              // Notify the originator of the results of the original read attributes 
    481              // attempt and, for each successfull request, the value of the requested 
    482              // attribute
    483            }
    484          
    485            return TRUE; 
    486          }
    487          #endif // ZCL_READ
    488          
    489          #ifdef ZCL_WRITE
    490          /*********************************************************************
    491           * @fn      zclSampleLight_ProcessInWriteRspCmd
    492           *
    493           * @brief   Process the "Profile" Write Response Command
    494           *
    495           * @param   pInMsg - incoming message to process
    496           *
    497           * @return  none
    498           */
    499          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    500          {
    501            zclWriteRspCmd_t *writeRspCmd;
    502            uint8 i;
    503          
    504            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    505            for (i = 0; i < writeRspCmd->numAttr; i++)
    506            {
    507              // Notify the device of the results of the its original write attributes
    508              // command.
    509            }
    510          
    511            return TRUE; 
    512          }
    513          #endif // ZCL_WRITE
    514          
    515          /*********************************************************************
    516           * @fn      zclSampleLight_ProcessInDefaultRspCmd
    517           *
    518           * @brief   Process the "Profile" Default Response Command
    519           *
    520           * @param   pInMsg - incoming message to process
    521           *
    522           * @return  none
    523           */
    524          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
    525          {
    526            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
    527             
    528            // Device is notified of the Default Response command.
    529            (void)pInMsg;
    530           // HalLedSet ( HAL_LED_1, HAL_LED_MODE_TROGGLE );
    531            
    532            return TRUE; 
    533          }
    534          
    535          #ifdef ZCL_DISCOVER
    536          /*********************************************************************
    537           * @fn      zclSampleLight_ProcessInDiscRspCmd
    538           *
    539           * @brief   Process the "Profile" Discover Response Command
    540           *
    541           * @param   pInMsg - incoming message to process
    542           *
    543           * @return  none
    544           */
    545          static uint8 zclSampleLight_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg )
    546          {
    547            zclDiscoverRspCmd_t *discoverRspCmd;
    548            uint8 i;
    549            
    550            discoverRspCmd = (zclDiscoverRspCmd_t *)pInMsg->attrCmd;
    551            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    552            {
    553              // Device is notified of the result of its attribute discovery command.
    554            }
    555            
    556            return TRUE;
    557          }
    558          #endif // ZCL_DISCOVER
    559          
    560          
    561          /****************************************************************************
    562          ****************************************************************************/
    563          
    564          

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     zclSampleLight_BasicResetCB        0      0      0
     zclSampleLight_IdentifyCB          2      0      0
       -> HalLedBlink                   4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
     zclSampleLight_IdentifyQueryRspCB
                                        0      0      0
     zclSampleLight_Init                0      0      9
       -> zclHA_Init                    0      0     18
       -> zclGeneral_RegisterCmdCallbacks
                                        0      0     18
       -> zcl_registerAttrList          0      0     18
       -> zcl_registerForMsg            0      0     18
       -> RegisterForKeys               0      0     18
       -> afRegister                    0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
     zclSampleLight_OnOffCB             0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
     zclSampleLight_event_loop          0      0     30
       -> NLME_GetShortAddr             0      0     42
       -> ZDP_EndDeviceBindReq          0      0     60
       -> osal_msg_deallocate           0      0     42
       -> osal_msg_receive              0      0     42
       -> HalLedSet                     0      0     42
       -> osal_mem_free                 0      0     42


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     zclSampleLight_TaskID                             1
     sampleLight_TestEp                                6
     zclSampleLight_CmdCallbacks                      30
     zclSampleLight_Init                              70
     ?Subroutine0                                      5
     zclSampleLight_event_loop                       322
     ?Subroutine2                                      4
     ?Subroutine3                                     12
     ?Subroutine1                                     14
     zclSampleLight_BasicResetCB                       3
     zclSampleLight_IdentifyCB                        66
     zclSampleLight_IdentifyQueryRspCB
                                                       3
     zclSampleLight_OnOffCB                           47
     ?<Initializer for sampleLight_TestEp>             6
     ?<Initializer for zclSampleLight_CmdCallbacks>   30
     ??zclSampleLight_Init?relay                       6
     ??zclSampleLight_event_loop?relay                 6
     ??zclSampleLight_BasicResetCB?relay               6
     ??zclSampleLight_IdentifyCB?relay                 6
     ??zclSampleLight_IdentifyQueryRspCB?relay         6
     ??zclSampleLight_OnOffCB?relay                    6

 
 546 bytes in segment BANKED_CODE
  36 bytes in segment BANK_RELAYS
  36 bytes in segment XDATA_I
  36 bytes in segment XDATA_ID
   1 byte  in segment XDATA_Z
 
 618 bytes of CODE  memory
  37 bytes of XDATA memory

Errors: none
Warnings: none
