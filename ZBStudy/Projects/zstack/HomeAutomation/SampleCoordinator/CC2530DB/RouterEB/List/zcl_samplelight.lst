###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Nov/2016  11:31:02 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\Source\zcl_samplelight.c #
#    Command line       =  -f E:\gitshell\ZigBee\ZBStudy\Projects\zstack\Home #
#                          Automation\SampleCoordinator\CC2530DB\..\..\..\Too #
#                          ls\CC2530DB\f8wRouter.cfg (-DCPU32MHZ              #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\Tools\ #
#                          CC2530DB\f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0     #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF2                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\Tools\ #
#                          CC2530DB\f8wZCL.cfg (-DZCL_READ -DZCL_WRITE        #
#                          -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF            #
#                          -DZCL_KEY_ESTABLISH -DZCL_KEY_ESTABLISHMENT_KEY_GE #
#                          NERATE_TIMEOUT=4 -DZCL_KEY_ESTABLISHMENT_MAC_GENER #
#                          ATE_TIMEOUT=10 -DZCL_KEY_ESTABLISHMENT_EKEY_GENERA #
#                          TE_TIMEOUT=10 -DZCL_LOAD_CONTROL                   #
#                          -DZCL_SIMPLE_METERING -DZCL_PRICING -DZCL_MESSAGE  #
#                          -DZCL_TUNNELING -DZCL_TOU) -DZCL_DEVICE_MGMT       #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\Source\zcl_samplelight.c #
#                           -D ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D          #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -lC E:\gitshell\ZigBee\ZBStudy\Projects\zstack\Hom #
#                          eAutomation\SampleCoordinator\CC2530DB\RouterEB\Li #
#                          st\ -lA E:\gitshell\ZigBee\ZBStudy\Projects\zstack #
#                          \HomeAutomation\SampleCoordinator\CC2530DB\RouterE #
#                          B\List\ --diag_suppress Pe001,Pa010 -o             #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\RouterEB\Obj\   #
#                          -e --no_code_motion --debug --core=plain           #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I E:\gitshell\ZigBee\ZBStudy #
#                          \Projects\zstack\HomeAutomation\SampleCoordinator\ #
#                          CC2530DB\ -I E:\gitshell\ZigBee\ZBStudy\Projects\z #
#                          stack\HomeAutomation\SampleCoordinator\CC2530DB\.. #
#                          \Source\ -I E:\gitshell\ZigBee\ZBStudy\Projects\zs #
#                          tack\HomeAutomation\SampleCoordinator\CC2530DB\..\ #
#                          ..\Source\ -I E:\gitshell\ZigBee\ZBStudy\Projects\ #
#                          zstack\HomeAutomation\SampleCoordinator\CC2530DB\. #
#                          .\..\..\ZMain\TI2530DB\ -I                         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\hal\include\ -I                         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\hal\target\CC2530EB\ -I                 #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\mac\include\ -I                         #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\mac\high_level\ -I                      #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\mac\low_level\srf04\ -I                 #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\mac\low_level\srf04\single_chip\ -I     #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\mt\ -I E:\gitshell\ZigBee\ZBStudy\Proje #
#                          cts\zstack\HomeAutomation\SampleCoordinator\CC2530 #
#                          DB\..\..\..\..\..\Components\osal\include\ -I      #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\services\saddr\ -I                      #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\services\sdata\ -I                      #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\af\ -I E:\gitshell\ZigBee\ZBStudy #
#                          \Projects\zstack\HomeAutomation\SampleCoordinator\ #
#                          CC2530DB\..\..\..\..\..\Components\stack\nwk\ -I   #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\sapi\ -I                          #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\sec\ -I                           #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\sys\ -I                           #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\zcl\ -I                           #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\zdo\ -I                           #
#                          E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\..\..\..\..\..\ #
#                          Components\zmac\ -I E:\gitshell\ZigBee\ZBStudy\Pro #
#                          jects\zstack\HomeAutomation\SampleCoordinator\CC25 #
#                          30DB\..\..\..\..\..\Components\zmac\f8w\ -Ohz      #
#                          --require_prototypes                               #
#    List file          =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\RouterEB\List\z #
#                          cl_samplelight.lst                                 #
#    Object file        =  E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAut #
#                          omation\SampleCoordinator\CC2530DB\RouterEB\Obj\zc #
#                          l_samplelight.r51                                  #
#                                                                             #
#                                                                             #
###############################################################################

E:\gitshell\ZigBee\ZBStudy\Projects\zstack\HomeAutomation\SampleCoordinator\Source\zcl_samplelight.c
      1          /**************************************************************************************************
      2            Filename:       zcl_sampleLight.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6          
      7            Description:    Zigbee Cluster Library - sample device application.
      8          
      9          
     10            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42            This device will be like a Light device.  This application is not
     43            intended to be a Light device, but will use the device description
     44            to implement this sample code.
     45          *********************************************************************/
     46          
     47          /*********************************************************************
     48           * INCLUDES
     49           */
     50          #include "ZComDef.h"
     51          #include "OSAL.h"
     52          #include "AF.h"
     53          #include "ZDApp.h"
     54          
     55          #include "zcl.h"
     56          #include "zcl_general.h"
     57          #include "zcl_ha.h"
     58          
     59          #include "zcl_samplelight.h"
     60          
     61          #include "onboard.h"
     62          
     63          /* HAL */
     64          #include "hal_lcd.h"
     65          #include "hal_led.h"
     66          #include "hal_key.h"
     67          
     68          
     69          /*********************************************************************
     70           * MACROS
     71           */
     72          
     73          /*********************************************************************
     74           * CONSTANTS
     75           */
     76          /*********************************************************************
     77           * TYPEDEFS
     78           */
     79          
     80          /*********************************************************************
     81           * GLOBAL VARIABLES
     82           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     83          byte zclSampleLight_TaskID;
   \                     zclSampleLight_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     84          
     85          /*********************************************************************
     86           * GLOBAL FUNCTIONS
     87           */
     88          
     89          /*********************************************************************
     90           * LOCAL VARIABLES
     91           */
     92          //static afAddrType_t zclSampleLight_DstAddr;
     93          
     94          // Test Endpoint to allow SYS_APP_MSGs

   \                                 In  segment XDATA_I, align 1, keep-with-next
     95          static endPointDesc_t sampleLight_TestEp =
   \                     sampleLight_TestEp:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for sampleLight_TestEp>`
   \   000006                REQUIRE __INIT_XDATA_I
     96          {
     97            SAMPLELIGHT_ENDPOINT,                                 // Test endpoint
     98            &zclSampleLight_TaskID,
     99            (SimpleDescriptionFormat_t *)&zclSampleLight_SimpleDesc,  // No Simple description for this test endpoint
    100            (afNetworkLatencyReq_t)0            // No Network Latency req
    101          };
    102          
    103          /*********************************************************************
    104           * LOCAL FUNCTIONS
    105           */
    106          static void zclSampleLight_HandleKeys( byte shift, byte keys );
    107          static void zclSampleLight_BasicResetCB( void );
    108          static void zclSampleLight_IdentifyCB( zclIdentify_t *pCmd );
    109          static void zclSampleLight_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp );
    110          static void zclSampleLight_OnOffCB( uint8 cmd );
    111          static void zclSampleLight_ProcessIdentifyTimeChange( void );
    112          static void afSampleLight_ProcessIncomingMsg( afIncomingMSGPacket_t *pInMsg );
    113          // Functions to process ZCL Foundation incoming Command/Response messages 
    114          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    115          #ifdef ZCL_READ
    116          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    117          #endif
    118          #ifdef ZCL_WRITE
    119          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    120          #endif
    121          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    122          #ifdef ZCL_DISCOVER
    123          static uint8 zclSampleLight_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg );
    124          #endif
    125          
    126          /*********************************************************************
    127           * ZCL General Profile Callback table
    128           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          static zclGeneral_AppCallbacks_t zclSampleLight_CmdCallbacks =
   \                     zclSampleLight_CmdCallbacks:
   \   000000                DS 30
   \   00001E                REQUIRE `?<Initializer for zclSampleLight_CmdCallbacks>`
   \   00001E                REQUIRE __INIT_XDATA_I
    130          {
    131            zclSampleLight_BasicResetCB,              // Basic Cluster Reset command
    132            zclSampleLight_IdentifyCB,                // Identify command  
    133            zclSampleLight_IdentifyQueryRspCB,        // Identify Query Response command
    134            zclSampleLight_OnOffCB,                   // On/Off cluster command
    135            NULL,                                     // Level Control Move to Level command
    136            NULL,                                     // Level Control Move command
    137            NULL,                                     // Level Control Step command
    138            NULL,                                     // Group Response commands
    139            NULL,                                     // Scene Store Request command
    140            NULL,                                     // Scene Recall Request command
    141            NULL,                                     // Scene Response command
    142            NULL,                                     // Alarm (Response) command
    143            NULL,                                     // RSSI Location commands
    144            NULL,                                     // RSSI Location Response commands
    145          };
    146          
    147          /*********************************************************************
    148           * @fn          zclSampleLight_Init
    149           *
    150           * @brief       Initialization function for the zclGeneral layer.
    151           *
    152           * @param       none
    153           *
    154           * @return      none
    155           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    156          void zclSampleLight_Init( byte task_id )
   \                     zclSampleLight_Init:
    157          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    158            zclSampleLight_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000009   F0           MOVX    @DPTR,A
    159          
    160            // Set destination address to indirect
    161            //zclSampleLight_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
    162            //zclSampleLight_DstAddr.endPoint = 0;
    163            //zclSampleLight_DstAddr.addr.shortAddr = 0;
    164          
    165            // This app is part of the Home Automation Profile
    166            zclHA_Init( &zclSampleLight_SimpleDesc );
   \   00000A                ; Setup parameters for call to function zclHA_Init
   \   00000A   7A..         MOV     R2,#zclSampleLight_SimpleDesc & 0xff
   \   00000C   7B..         MOV     R3,#(zclSampleLight_SimpleDesc >> 8) & 0xff
   \   00000E   12....       LCALL   ??zclHA_Init?relay
    167          
    168            // Register the ZCL General Cluster Library callback functions
    169            zclGeneral_RegisterCmdCallbacks( SAMPLELIGHT_ENDPOINT, &zclSampleLight_CmdCallbacks );
   \   000011                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   000011   7A..         MOV     R2,#zclSampleLight_CmdCallbacks & 0xff
   \   000013   7B..         MOV     R3,#(zclSampleLight_CmdCallbacks >> 8) & 0xff
   \   000015   7914         MOV     R1,#0x14
   \   000017   12....       LCALL   ??zclGeneral_RegisterCmdCallbacks?relay
    170          
    171            // Register the application's attribute list
    172            zcl_registerAttrList( SAMPLELIGHT_ENDPOINT, SAMPLELIGHT_MAX_ATTRIBUTES, zclSampleLight_Attrs );
   \   00001A                ; Setup parameters for call to function zcl_registerAttrList
   \   00001A   7C..         MOV     R4,#zclSampleLight_Attrs & 0xff
   \   00001C   7D..         MOV     R5,#(zclSampleLight_Attrs >> 8) & 0xff
   \   00001E   7A0C         MOV     R2,#0xc
   \   000020   7914         MOV     R1,#0x14
   \   000022   12....       LCALL   ??zcl_registerAttrList?relay
    173          
    174            // Register the Application to receive the unprocessed Foundation command/response messages
    175            zcl_registerForMsg( zclSampleLight_TaskID );
   \   000025                ; Setup parameters for call to function zcl_registerForMsg
   \   000025   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F9           MOV     R1,A
   \   00002A   12....       LCALL   ??zcl_registerForMsg?relay
    176            
    177            // Register for all key events - This app will handle all key events
    178            RegisterForKeys( zclSampleLight_TaskID );
   \   00002D                ; Setup parameters for call to function RegisterForKeys
   \   00002D   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F9           MOV     R1,A
   \   000032   12....       LCALL   ??RegisterForKeys?relay
    179          
    180            // Register for a test endpoint
    181            afRegister( &sampleLight_TestEp );
   \   000035                ; Setup parameters for call to function afRegister
   \   000035   7A..         MOV     R2,#sampleLight_TestEp & 0xff
   \   000037   7B..         MOV     R3,#(sampleLight_TestEp >> 8) & 0xff
   \   000039   12....       LCALL   ??afRegister?relay
    182            
    183            NLME_PermitJoiningRequest(0);
   \   00003C                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   00003C   7900         MOV     R1,#0x0
   \   00003E   12....       LCALL   ??NLME_PermitJoiningRequest?relay
    184          }
   \   000041                REQUIRE ?Subroutine0
   \   000041                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    185          
    186          /*********************************************************************
    187           * @fn          zclSample_event_loop
    188           *
    189           * @brief       Event Loop Processor for zclGeneral.
    190           *
    191           * @param       none
    192           *
    193           * @return      none
    194           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    195          uint16 zclSampleLight_event_loop( uint8 task_id, uint16 events )
   \                     zclSampleLight_event_loop:
    196          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    197            afIncomingMSGPacket_t *MSGpkt;
    198            
    199            (void)task_id;  // Intentionally unreferenced parameter
    200          
    201            if ( events & SYS_EVENT_MSG )
   \   000009   EB           MOV     A,R3
   \   00000A   5480         ANL     A,#0x80
   \   00000C   703A         JNZ     ??zclSampleLight_event_loop_0
    202            {
    203              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclSampleLight_TaskID )) )
    204              {
    205                switch ( MSGpkt->hdr.event )
    206                {
    207                  case AF_INCOMING_MSG_CMD:
    208                    afSampleLight_ProcessIncomingMsg( (afIncomingMSGPacket_t *)MSGpkt );
    209                    break;
    210                  case ZCL_INCOMING_MSG:
    211                    // Incoming ZCL Foundation command/response messages
    212                    zclSampleLight_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    213                    break;
    214                    
    215                  case KEY_CHANGE:
    216                    zclSampleLight_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    217                    break;
    218          
    219                  default:
    220                    break;
    221                }
    222          
    223                // Release the memory
    224                osal_msg_deallocate( (uint8 *)MSGpkt );
    225              }
    226          
    227              // return unprocessed events
    228              return (events ^ SYS_EVENT_MSG);
    229            }
    230          
    231            if ( events & SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT )
   \   00000E   EA           MOV     A,R2
   \   00000F   A2E0         MOV     C,0xE0 /* A   */.0
   \   000011   4003         JC      $+5
   \   000013   02....       LJMP    ??zclSampleLight_event_loop_1 & 0xFFFF
    232            {
    233              if ( zclSampleLight_IdentifyTime > 0 )
   \   000016   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000019   600C         JZ      ??zclSampleLight_event_loop_2
    234                zclSampleLight_IdentifyTime--;
   \   00001B   90....       MOV     DPTR,#zclSampleLight_IdentifyTime
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   24FF         ADD     A,#-0x1
   \   000021   F0           MOVX    @DPTR,A
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   34FF         ADDC    A,#-0x1
   \   000026   F0           MOVX    @DPTR,A
    235              zclSampleLight_ProcessIdentifyTimeChange();
   \                     ??zclSampleLight_event_loop_2:
   \   000027                ; Setup parameters for call to function zclSampleLight_ProcessIdentifyTimeChange
   \   000027   12....       LCALL   ??zclSampleLight_ProcessIdentifyTimeChange?rela
    236          
    237              return ( events ^ SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT );
   \   00002A   E5..         MOV     A,?V0 + 0
   \   00002C   6401         XRL     A,#0x1
   \   00002E   FA           MOV     R2,A
   \   00002F   AB..         MOV     R3,?V0 + 1
   \   000031   02....       LJMP    ??zclSampleLight_event_loop_3 & 0xFFFF
    238            }
   \                     ??zclSampleLight_event_loop_4:
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   A2E1         MOV     C,0xE0 /* A   */.1
   \   00003A   5005         JNC     ??zclSampleLight_event_loop_5
   \   00003C                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   00003C   793C         MOV     R1,#0x3c
   \   00003E   12....       LCALL   ??NLME_PermitJoiningRequest?relay
   \                     ??zclSampleLight_event_loop_5:
   \   000041                ; Setup parameters for call to function osal_msg_deallocate
   \   000041   EE           MOV     A,R6
   \   000042   FA           MOV     R2,A
   \   000043   EF           MOV     A,R7
   \   000044   FB           MOV     R3,A
   \   000045   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??zclSampleLight_event_loop_0:
   \   000048                ; Setup parameters for call to function osal_msg_receive
   \   000048   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F9           MOV     R1,A
   \   00004D   12....       LCALL   ??osal_msg_receive?relay
   \   000050   8A..         MOV     ?V0 + 2,R2
   \   000052   8B..         MOV     ?V0 + 3,R3
   \   000054   AE..         MOV     R6,?V0 + 2
   \   000056   AF..         MOV     R7,?V0 + 3
   \   000058   EE           MOV     A,R6
   \   000059   4F           ORL     A,R7
   \   00005A   6068         JZ      ??zclSampleLight_event_loop_6
   \   00005C   8E82         MOV     DPL,R6
   \   00005E   8F83         MOV     DPH,R7
   \   000060   E0           MOVX    A,@DPTR
   \   000061   24E6         ADD     A,#-0x1a
   \   000063   600A         JZ      ??zclSampleLight_event_loop_7
   \   000065   24E6         ADD     A,#-0x1a
   \   000067   601C         JZ      ??zclSampleLight_event_loop_8
   \   000069   2474         ADD     A,#0x74
   \   00006B   60C7         JZ      ??zclSampleLight_event_loop_4
   \   00006D   80D2         SJMP    ??zclSampleLight_event_loop_5
   \                     ??zclSampleLight_event_loop_7:
   \   00006F   A3           INC     DPTR
   \   000070   A3           INC     DPTR
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   E0           MOVX    A,@DPTR
   \   000074   6406         XRL     A,#0x6
   \   000076   7002         JNZ     ??zclSampleLight_event_loop_9
   \   000078   A3           INC     DPTR
   \   000079   E0           MOVX    A,@DPTR
   \                     ??zclSampleLight_event_loop_9:
   \   00007A   70C5         JNZ     ??zclSampleLight_event_loop_5
   \   00007C                ; Setup parameters for call to function HalLedSet
   \   00007C   7A08         MOV     R2,#0x8
   \   00007E   7901         MOV     R1,#0x1
   \   000080   12....       LCALL   ??HalLedSet?relay
   \   000083   80BC         SJMP    ??zclSampleLight_event_loop_5
   \                     ??zclSampleLight_event_loop_8:
   \   000085   A3           INC     DPTR
   \   000086   A3           INC     DPTR
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   14           DEC     A
   \   00008E   6011         JZ      ??zclSampleLight_event_loop_10
   \   000090   24FD         ADD     A,#-0x3
   \   000092   701A         JNZ     ??zclSampleLight_event_loop_11
   \   000094   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F8           MOV     R0,A
   \   000099   E9           MOV     A,R1
   \   00009A   C3           CLR     C
   \   00009B   98           SUBB    A,R0
   \   00009C   5010         JNC     ??zclSampleLight_event_loop_11
   \   00009E   09           INC     R1
   \   00009F   80F6         SJMP    ??CrossCallReturnLabel_0
   \                     ??zclSampleLight_event_loop_10:
   \   0000A1   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000A4   8001         SJMP    ??zclSampleLight_event_loop_12
   \                     ??zclSampleLight_event_loop_13:
   \   0000A6   09           INC     R1
   \                     ??zclSampleLight_event_loop_12:
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F8           MOV     R0,A
   \   0000A9   E9           MOV     A,R1
   \   0000AA   C3           CLR     C
   \   0000AB   98           SUBB    A,R0
   \   0000AC   40F8         JC      ??zclSampleLight_event_loop_13
   \                     ??zclSampleLight_event_loop_11:
   \   0000AE   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   0000B1   12....       LCALL   ??Subroutine6_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   0000B4   608B         JZ      ??zclSampleLight_event_loop_5
   \   0000B6                ; Setup parameters for call to function osal_mem_free
   \   0000B6   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   FA           MOV     R2,A
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   FB           MOV     R3,A
   \   0000BE   12....       LCALL   ??osal_mem_free?relay
   \   0000C1   02....       LJMP    ??zclSampleLight_event_loop_5 & 0xFFFF
   \                     ??zclSampleLight_event_loop_6:
   \   0000C4   AA..         MOV     R2,?V0 + 0
   \   0000C6   E5..         MOV     A,?V0 + 1
   \   0000C8   6480         XRL     A,#0x80
   \   0000CA   FB           MOV     R3,A
   \   0000CB   8004         SJMP    ??zclSampleLight_event_loop_3
    239          
    240            // Discard unknown events
    241            return 0;
   \                     ??zclSampleLight_event_loop_1:
   \   0000CD   7A00         MOV     R2,#0x0
   \   0000CF   7B00         MOV     R3,#0x0
   \                     ??zclSampleLight_event_loop_3:
   \   0000D1   7F04         MOV     R7,#0x4
   \   0000D3   02....       LJMP    ?BANKED_LEAVE_XDATA
    242          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   EE           MOV     A,R6
   \   000001   2417         ADD     A,#0x17
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   8882         MOV     DPL,R0
   \   00000A   8983         MOV     DPH,R1
   \   00000C   7900         MOV     R1,#0x0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#zclSampleLight_IdentifyTime
   \   000003                REQUIRE ??Subroutine6_0
   \   000003                ; // Fall through to label ??Subroutine6_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine6_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   E8           MOV     A,R0
   \   000006   49           ORL     A,R1
   \   000007   22           RET
    243          
    244          /*********************************************************************
    245           * @fn      zclSampleLight_HandleKeys
    246           *
    247           * @brief   Handles all key events for this device.
    248           *
    249           * @param   shift - true if in shift/alt.
    250           * @param   keys - bit field for key events. Valid entries:
    251           *                 HAL_KEY_SW_4
    252           *                 HAL_KEY_SW_3
    253           *                 HAL_KEY_SW_2
    254           *                 HAL_KEY_SW_1
    255           *
    256           * @return  none
    257           */
    258          static void zclSampleLight_HandleKeys( byte shift, byte keys )
    259          {
    260            //zAddrType_t dstAddr;
    261            
    262            (void)shift;  // Intentionally unreferenced parameter
    263          
    264            if ( keys & HAL_KEY_SW_2 )
    265            {
    266              NLME_PermitJoiningRequest(60);
    267            }
    268          }
    269          
    270          /*********************************************************************
    271           * @fn      zclSampleLight_ProcessIdentifyTimeChange
    272           *
    273           * @brief   Called to process any change to the IdentifyTime attribute.
    274           *
    275           * @param   none
    276           *
    277           * @return  none
    278           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    279          static void zclSampleLight_ProcessIdentifyTimeChange( void )
   \                     zclSampleLight_ProcessIdentifyTimeChange:
    280          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    281            if ( zclSampleLight_IdentifyTime > 0 )
   \   000004   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000007   601F         JZ      ??zclSampleLight_ProcessIdentifyTimeChange_0
    282            {
    283              osal_start_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT, 1000 );
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   7CE8         MOV     R4,#-0x18
   \   00000B   7D03         MOV     R5,#0x3
   \   00000D   7A01         MOV     R2,#0x1
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F9           MOV     R1,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
    284              HalLedBlink ( HAL_LED_4, 0xFF, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME );
   \   000019                ; Setup parameters for call to function HalLedBlink
   \   000019   7CE8         MOV     R4,#-0x18
   \   00001B   7D03         MOV     R5,#0x3
   \   00001D   7B05         MOV     R3,#0x5
   \   00001F   7AFF         MOV     R2,#-0x1
   \   000021   7908         MOV     R1,#0x8
   \   000023   12....       LCALL   ??HalLedBlink?relay
   \   000026   801D         SJMP    ??zclSampleLight_ProcessIdentifyTimeChange_1
    285            }
    286            else
    287            {
    288              if ( zclSampleLight_OnOff )
   \                     ??zclSampleLight_ProcessIdentifyTimeChange_0:
   \   000028   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   6004         JZ      ??zclSampleLight_ProcessIdentifyTimeChange_2
    289                HalLedSet ( HAL_LED_4, HAL_LED_MODE_ON );
   \   00002E                ; Setup parameters for call to function HalLedSet
   \   00002E   7A01         MOV     R2,#0x1
   \   000030   8002         SJMP    ??zclSampleLight_ProcessIdentifyTimeChange_3
    290              else
    291                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \                     ??zclSampleLight_ProcessIdentifyTimeChange_2:
   \   000032                ; Setup parameters for call to function HalLedSet
   \   000032   7A00         MOV     R2,#0x0
   \                     ??zclSampleLight_ProcessIdentifyTimeChange_3:
   \   000034   7908         MOV     R1,#0x8
   \   000036   12....       LCALL   ??HalLedSet?relay
    292              osal_stop_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_IDENTIFY_TIMEOUT_EVT );
   \   000039                ; Setup parameters for call to function osal_stop_timerEx
   \   000039   7A01         MOV     R2,#0x1
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   90....       MOV     DPTR,#zclSampleLight_TaskID
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   12....       LCALL   ??osal_stop_timerEx?relay
    293            }
    294          }
   \                     ??zclSampleLight_ProcessIdentifyTimeChange_1:
   \   000045                REQUIRE ?Subroutine1
   \   000045                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    295          
    296          /*********************************************************************
    297           * @fn      zclSampleLight_BasicResetCB
    298           *
    299           * @brief   Callback from the ZCL General Cluster Library
    300           *          to set all the Basic Cluster attributes to default values.
    301           *
    302           * @param   none
    303           *
    304           * @return  none
    305           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    306          static void zclSampleLight_BasicResetCB( void )
   \                     zclSampleLight_BasicResetCB:
    307          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    308            // Reset all attributes to default values
    309          }
   \   000000   02....       LJMP    ?BRET
    310          
    311          /*********************************************************************
    312           * @fn      zclSampleLight_IdentifyCB
    313           *
    314           * @brief   Callback from the ZCL General Cluster Library when
    315           *          it received an Identity Command for this application.
    316           *
    317           * @param   srcAddr - source address and endpoint of the response message
    318           * @param   identifyTime - the number of seconds to identify yourself
    319           *
    320           * @return  none
    321           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    322          static void zclSampleLight_IdentifyCB( zclIdentify_t *pCmd )
   \                     zclSampleLight_IdentifyCB:
    323          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    324            zclSampleLight_IdentifyTime = pCmd->identifyTime;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F8           MOV     R0,A
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   90....       MOV     DPTR,#zclSampleLight_IdentifyTime
   \   000012   E8           MOV     A,R0
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
    325            zclSampleLight_ProcessIdentifyTimeChange();
   \   000017                ; Setup parameters for call to function zclSampleLight_ProcessIdentifyTimeChange
   \   000017   12....       LCALL   ??zclSampleLight_ProcessIdentifyTimeChange?rela
    326          }
   \   00001A   80..         SJMP    ?Subroutine1
    327          
    328          /*********************************************************************
    329           * @fn      zclSampleLight_IdentifyQueryRspCB
    330           *
    331           * @brief   Callback from the ZCL General Cluster Library when
    332           *          it received an Identity Query Response Command for this application.
    333           *
    334           * @param   srcAddr - requestor's address
    335           * @param   timeout - number of seconds to identify yourself (valid for query response)
    336           *
    337           * @return  none
    338           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    339          static void zclSampleLight_IdentifyQueryRspCB(  zclIdentifyQueryRsp_t *pRsp )
   \                     zclSampleLight_IdentifyQueryRspCB:
    340          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    341            // Query Response (with timeout value)
    342            (void)pRsp;
    343          }
   \   000000   02....       LJMP    ?BRET
    344          
    345          /*********************************************************************
    346           * @fn      zclSampleLight_OnOffCB
    347           *
    348           * @brief   Callback from the ZCL General Cluster Library when
    349           *          it received an On/Off Command for this application.
    350           *
    351           * @param   cmd - COMMAND_ON, COMMAND_OFF or COMMAND_TOGGLE
    352           *
    353           * @return  none
    354           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    355          static void zclSampleLight_OnOffCB( uint8 cmd )
   \                     zclSampleLight_OnOffCB:
    356          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    357            // Turn on the light
    358            if ( cmd == COMMAND_ON )
   \   000007   7401         MOV     A,#0x1
   \   000009   6E           XRL     A,R6
   \   00000A   700F         JNZ     ??zclSampleLight_OnOffCB_0
    359              zclSampleLight_OnOff = LIGHT_ON;
   \                     ??zclSampleLight_OnOffCB_1:
   \   00000C   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   00000F   7401         MOV     A,#0x1
   \                     ??zclSampleLight_OnOffCB_2:
   \   000011   F0           MOVX    @DPTR,A
    360          
    361            // Turn off the light
    362            else if ( cmd == COMMAND_OFF )
    363              zclSampleLight_OnOff = LIGHT_OFF;
    364          
    365            // Toggle the light
    366            else
    367            {
    368              if ( zclSampleLight_OnOff == LIGHT_OFF )
    369                zclSampleLight_OnOff = LIGHT_ON;
    370              else
    371                zclSampleLight_OnOff = LIGHT_OFF;
    372            }
    373          
    374            // In this sample app, we use LED4 to simulate the Light
    375            if ( zclSampleLight_OnOff == LIGHT_ON )
    376              HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   FA           MOV     R2,A
   \   000013   7908         MOV     R1,#0x8
   \   000015   12....       LCALL   ??HalLedSet?relay
    377            else
    378              HalLedSet( HAL_LED_4, HAL_LED_MODE_OFF );
    379          }
   \   000018   02....       LJMP    ?Subroutine0 & 0xFFFF
   \                     ??zclSampleLight_OnOffCB_0:
   \   00001B   EE           MOV     A,R6
   \   00001C   7006         JNZ     ??zclSampleLight_OnOffCB_3
   \                     ??zclSampleLight_OnOffCB_4:
   \   00001E   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   000021   E4           CLR     A
   \   000022   80ED         SJMP    ??zclSampleLight_OnOffCB_2
   \                     ??zclSampleLight_OnOffCB_3:
   \   000024   90....       MOV     DPTR,#zclSampleLight_OnOff
   \   000027   E0           MOVX    A,@DPTR
   \   000028   70F4         JNZ     ??zclSampleLight_OnOffCB_4
   \   00002A   80E0         SJMP    ??zclSampleLight_OnOffCB_1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sampleLight_TestEp>`:
   \   000000   14           DB 20
   \   000001   ....         DW zclSampleLight_TaskID
   \   000003   ....         DW zclSampleLight_SimpleDesc
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleLight_CmdCallbacks>`:
   \   000000   ....         DW ??zclSampleLight_BasicResetCB?relay
   \   000002   ....         DW ??zclSampleLight_IdentifyCB?relay
   \   000004   ....         DW ??zclSampleLight_IdentifyQueryRspCB?relay
   \   000006   ....         DW ??zclSampleLight_OnOffCB?relay
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H
   \   000012   0000         DW 0H
   \   000014   0000         DW 0H
   \   000016   0000         DW 0H
   \   000018   0000         DW 0H
   \   00001A   0000         DW 0H
   \   00001C   0000         DB 0, 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_ProcessIdentifyTimeChange?rela:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_ProcessIdentifyTimeChange

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_BasicResetCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_IdentifyCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_IdentifyCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_IdentifyQueryRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_IdentifyQueryRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleLight_OnOffCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_OnOffCB
    380          
    381          
    382          /****************************************************************************** 
    383           * 
    384           *  Functions for processing ZCL Foundation incoming Command/Response messages
    385           *
    386           *****************************************************************************/
    387          
    388          /*********************************************************************
    389           * @fn      zclSampleLight_ProcessIncomingMsg
    390           *
    391           * @brief   Process ZCL Foundation incoming message
    392           *
    393           * @param   pInMsg - pointer to the received message
    394           *
    395           * @return  none
    396           */
    397          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg)
    398          {
    399            switch ( pInMsg->zclHdr.commandID )
    400            {
    401          #ifdef ZCL_READ
    402              case ZCL_CMD_READ_RSP:
    403                zclSampleLight_ProcessInReadRspCmd( pInMsg );
    404                break;
    405          #endif
    406          #ifdef ZCL_WRITE    
    407              case ZCL_CMD_WRITE_RSP:
    408                zclSampleLight_ProcessInWriteRspCmd( pInMsg );
    409                break;
    410          #endif
    411          #ifdef ZCL_REPORT
    412              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    413              case ZCL_CMD_CONFIG_REPORT:
    414                //zclSampleLight_ProcessInConfigReportCmd( pInMsg );
    415                break;
    416              
    417              case ZCL_CMD_CONFIG_REPORT_RSP:
    418                //zclSampleLight_ProcessInConfigReportRspCmd( pInMsg );
    419                break;
    420              
    421              case ZCL_CMD_READ_REPORT_CFG:
    422                //zclSampleLight_ProcessInReadReportCfgCmd( pInMsg );
    423                break;
    424              
    425              case ZCL_CMD_READ_REPORT_CFG_RSP:
    426                //zclSampleLight_ProcessInReadReportCfgRspCmd( pInMsg );
    427                break;
    428              
    429              case ZCL_CMD_REPORT:
    430                //zclSampleLight_ProcessInReportCmd( pInMsg );
    431                break;
    432          #endif   
    433              case ZCL_CMD_DEFAULT_RSP:
    434                zclSampleLight_ProcessInDefaultRspCmd( pInMsg );
    435                break;
    436          #ifdef ZCL_DISCOVER     
    437              case ZCL_CMD_DISCOVER_RSP:
    438                zclSampleLight_ProcessInDiscRspCmd( pInMsg );
    439                break;
    440          #endif  
    441              default:
    442                break;
    443            }
    444            
    445            if ( pInMsg->attrCmd )
    446              osal_mem_free( pInMsg->attrCmd );
    447          }
    448          
    449          #ifdef ZCL_READ
    450          /*********************************************************************
    451           * @fn      zclSampleLight_ProcessInReadRspCmd
    452           *
    453           * @brief   Process the "Profile" Read Response Command
    454           *
    455           * @param   pInMsg - incoming message to process
    456           *
    457           * @return  none
    458           */
    459          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    460          {
    461            zclReadRspCmd_t *readRspCmd;
    462            uint8 i;
    463          
    464            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    465            for (i = 0; i < readRspCmd->numAttr; i++)
    466            {
    467              // Notify the originator of the results of the original read attributes 
    468              // attempt and, for each successfull request, the value of the requested 
    469              // attribute
    470            }
    471          
    472            return TRUE; 
    473          }
    474          #endif // ZCL_READ
    475          
    476          #ifdef ZCL_WRITE
    477          /*********************************************************************
    478           * @fn      zclSampleLight_ProcessInWriteRspCmd
    479           *
    480           * @brief   Process the "Profile" Write Response Command
    481           *
    482           * @param   pInMsg - incoming message to process
    483           *
    484           * @return  none
    485           */
    486          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    487          {
    488            zclWriteRspCmd_t *writeRspCmd;
    489            uint8 i;
    490          
    491            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    492            for (i = 0; i < writeRspCmd->numAttr; i++)
    493            {
    494              // Notify the device of the results of the its original write attributes
    495              // command.
    496            }
    497          
    498            return TRUE; 
    499          }
    500          #endif // ZCL_WRITE
    501          
    502          /*********************************************************************
    503           * @fn      zclSampleLight_ProcessInDefaultRspCmd
    504           *
    505           * @brief   Process the "Profile" Default Response Command
    506           *
    507           * @param   pInMsg - incoming message to process
    508           *
    509           * @return  none
    510           */
    511          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
    512          {
    513            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
    514             
    515            // Device is notified of the Default Response command.
    516            (void)pInMsg;
    517            
    518            return TRUE; 
    519          }
    520          
    521          #ifdef ZCL_DISCOVER
    522          /*********************************************************************
    523           * @fn      zclSampleLight_ProcessInDiscRspCmd
    524           *
    525           * @brief   Process the "Profile" Discover Response Command
    526           *
    527           * @param   pInMsg - incoming message to process
    528           *
    529           * @return  none
    530           */
    531          static uint8 zclSampleLight_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg )
    532          {
    533            zclDiscoverRspCmd_t *discoverRspCmd;
    534            uint8 i;
    535            
    536            discoverRspCmd = (zclDiscoverRspCmd_t *)pInMsg->attrCmd;
    537            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    538            {
    539              // Device is notified of the result of its attribute discovery command.
    540            }
    541            
    542            return TRUE;
    543          }
    544          #endif // ZCL_DISCOVER
    545          
    546          static void afSampleLight_ProcessIncomingMsg( afIncomingMSGPacket_t *pInMsg ){
    547            switch ( pInMsg->clusterId ){
    548            case SAMPLE_RECEIVE_CLUSTERID:
    549               HalLedSet( HAL_LED_1, HAL_LED_MODE_TOGGLE ); 
    550               break;
    551               
    552             default:
    553              break;
    554            }
    555          }
    556          /****************************************************************************
    557          ****************************************************************************/
    558          
    559          

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     zclSampleLight_BasicResetCB        0      0      0
     zclSampleLight_IdentifyCB          2      0      0
       -> zclSampleLight_ProcessIdentifyTimeChange
                                        4      0      0
     zclSampleLight_IdentifyQueryRspCB
                                        0      0      0
     zclSampleLight_Init                0      0      9
       -> zclHA_Init                    0      0     18
       -> zclGeneral_RegisterCmdCallbacks
                                        0      0     18
       -> zcl_registerAttrList          0      0     18
       -> zcl_registerForMsg            0      0     18
       -> RegisterForKeys               0      0     18
       -> afRegister                    0      0     18
       -> NLME_PermitJoiningRequest     0      0     18
     zclSampleLight_OnOffCB             0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
     zclSampleLight_ProcessIdentifyTimeChange
                                        2      0     12
       -> osal_start_timerEx            4      0      0
       -> HalLedBlink                   4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_stop_timerEx             4      0      0
     zclSampleLight_event_loop          0      0     12
       -> zclSampleLight_ProcessIdentifyTimeChange
                                        0      0     24
       -> NLME_PermitJoiningRequest     0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> HalLedSet                     0      0     24
       -> osal_mem_free                 0      0     24


   Segment part sizes:

     Function/Label                                  Bytes
     --------------                                  -----
     zclSampleLight_TaskID                              1
     sampleLight_TestEp                                 6
     zclSampleLight_CmdCallbacks                       30
     zclSampleLight_Init                               65
     ?Subroutine0                                       5
     zclSampleLight_event_loop                        214
     ?Subroutine4                                       4
     ?Subroutine5                                      11
     ?Subroutine2                                      15
     ?Subroutine3                                       3
     ??Subroutine6_0                                    8
     zclSampleLight_ProcessIdentifyTimeChange
                                                       69
     ?Subroutine1                                       7
     zclSampleLight_BasicResetCB                        3
     zclSampleLight_IdentifyCB                         28
     zclSampleLight_IdentifyQueryRspCB
                                                        3
     zclSampleLight_OnOffCB                            44
     ?<Initializer for sampleLight_TestEp>              6
     ?<Initializer for zclSampleLight_CmdCallbacks>    30
     ??zclSampleLight_Init?relay                        6
     ??zclSampleLight_event_loop?relay                  6
     ??zclSampleLight_ProcessIdentifyTimeChange?rela    6
     ??zclSampleLight_BasicResetCB?relay                6
     ??zclSampleLight_IdentifyCB?relay                  6
     ??zclSampleLight_IdentifyQueryRspCB?relay          6
     ??zclSampleLight_OnOffCB?relay                     6

 
 479 bytes in segment BANKED_CODE
  42 bytes in segment BANK_RELAYS
  36 bytes in segment XDATA_I
  36 bytes in segment XDATA_ID
   1 byte  in segment XDATA_Z
 
 557 bytes of CODE  memory
  37 bytes of XDATA memory

Errors: none
Warnings: none
